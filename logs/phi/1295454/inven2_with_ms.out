### Starting TaskPrologue of job 1295454 on tg073 at Mon Nov  3 01:02:38 AM CET 2025
Running on cores 0-1,8-9,16-17,24-25 with governor ondemand
Mon Nov  3 01:02:38 2025       
+-----------------------------------------------------------------------------------------+
| NVIDIA-SMI 570.195.03             Driver Version: 570.195.03     CUDA Version: 12.8     |
|-----------------------------------------+------------------------+----------------------+
| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |
| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |
|                                         |                        |               MIG M. |
|=========================================+========================+======================|
|   0  Tesla V100-PCIE-32GB           Off |   00000000:18:00.0 Off |                    0 |
| N/A   28C    P0             26W /  250W |       0MiB /  32768MiB |      0%      Default |
|                                         |                        |                  N/A |
+-----------------------------------------+------------------------+----------------------+
                                                                                         
+-----------------------------------------------------------------------------------------+
| Processes:                                                                              |
|  GPU   GI   CI              PID   Type   Process name                        GPU Memory |
|        ID   ID                                                               Usage      |
|=========================================================================================|
|  No running processes found                                                             |
+-----------------------------------------------------------------------------------------+
### Finished TaskPrologue

Starting training at: Mon Nov  3 01:02:41 AM CET 2025

================================================================================
PHI-3.5-VISION MULTI-STAGE FINETUNING (QLoRA 4-bit) + OPTIONAL CONTRASTIVE
================================================================================
Output dir: /home/vault/iwi5/iwi5298h/models_image_text/phi/multistage/inven
‚úÖ Processor loaded
‚úÖ Model loaded in 4-bit
GPU allocated: 2.27 GB
‚úÖ LoRA applied | Trainable: 25,165,824 / 4,171,787,264

üìä Loading datasets...
   üìä Loaded 213 valid samples (out of 213 total)
   üîÑ Data augmentation ENABLED
   üìä Loaded 47 valid samples (out of 47 total)

================================================================================
STAGE 1: frozen vision, higher LR, no eval, teacher forcing
================================================================================
‚ö†Ô∏è Stage 1: no explicit vision module found to freeze (LoRA still trains).
{'loss': 26.2507, 'grad_norm': 5.083028793334961, 'learning_rate': 0.0004730040966344602, 'epoch': 0.75}
{'loss': 19.518, 'grad_norm': 6.045469284057617, 'learning_rate': 9.523405703440384e-05, 'epoch': 1.5}
{'train_runtime': 3981.0978, 'train_samples_per_second': 0.107, 'train_steps_per_second': 0.007, 'train_loss': 21.688474508432243, 'epoch': 1.95}
‚úÖ Stage 1 done.

================================================================================
STAGE 2: unfreeze vision, normal LR, eval per epoch, CER callback, save best
================================================================================
‚ö†Ô∏è Stage 2: no explicit vision module to unfreeze; will just train LoRA/LM heads.
{'loss': 16.95, 'grad_norm': 5.07474422454834, 'learning_rate': 0.00018181818181818183, 'epoch': 0.75}
{'eval_loss': 1.2443119287490845, 'eval_runtime': 169.2854, 'eval_samples_per_second': 0.278, 'eval_steps_per_second': 0.278, 'epoch': 0.98}

================================================================================
üîç COMPUTING CER ON VALIDATION SET (Epoch 0)
================================================================================
   ‚úÖ Validation CER: 2.9769 (297.69%)
   üéØ NEW BEST CER: 2.9769 (improved inf)
   üíæ Saving best model to: /home/vault/iwi5/iwi5298h/models_image_text/phi/multistage/inven/best_model
================================================================================

{'loss': 15.2892, 'grad_norm': 9.20900821685791, 'learning_rate': 0.00019541392564000488, 'epoch': 1.5}
{'eval_loss': 1.2221990823745728, 'eval_runtime': 168.8854, 'eval_samples_per_second': 0.278, 'eval_steps_per_second': 0.278, 'epoch': 1.95}

================================================================================
üîç COMPUTING CER ON VALIDATION SET (Epoch 1)
================================================================================
   ‚úÖ Validation CER: 2.7711 (277.11%)
   üéØ NEW BEST CER: 2.7711 (improved 0.2058)
   üíæ Saving best model to: /home/vault/iwi5/iwi5298h/models_image_text/phi/multistage/inven/best_model
================================================================================

{'loss': 13.7567, 'grad_norm': 9.162923812866211, 'learning_rate': 0.00018010010944693848, 'epoch': 2.25}
{'eval_loss': 1.2711371183395386, 'eval_runtime': 168.819, 'eval_samples_per_second': 0.278, 'eval_steps_per_second': 0.278, 'epoch': 2.93}

================================================================================
üîç COMPUTING CER ON VALIDATION SET (Epoch 2)
================================================================================
   ‚úÖ Validation CER: 2.8895 (288.95%)
   üìä No improvement. Best CER remains: 2.7711
================================================================================

{'loss': 12.1885, 'grad_norm': 13.206713676452637, 'learning_rate': 0.00015573244631224365, 'epoch': 3.0}
{'loss': 9.4058, 'grad_norm': 15.293076515197754, 'learning_rate': 0.00012506525322587207, 'epoch': 3.76}
{'eval_loss': 1.356460690498352, 'eval_runtime': 168.6901, 'eval_samples_per_second': 0.279, 'eval_steps_per_second': 0.279, 'epoch': 3.98}

================================================================================
üîç COMPUTING CER ON VALIDATION SET (Epoch 3)
================================================================================
   ‚úÖ Validation CER: 3.1713 (317.13%)
   üìä No improvement. Best CER remains: 2.7711
================================================================================

{'loss': 8.7064, 'grad_norm': 11.013673782348633, 'learning_rate': 9.156489339569554e-05, 'epoch': 4.51}
{'eval_loss': 1.4692655801773071, 'eval_runtime': 169.0346, 'eval_samples_per_second': 0.278, 'eval_steps_per_second': 0.278, 'epoch': 4.96}

================================================================================
üîç COMPUTING CER ON VALIDATION SET (Epoch 4)
================================================================================
   ‚úÖ Validation CER: 3.0737 (307.37%)
   üìä No improvement. Best CER remains: 2.7711
================================================================================

{'loss': 7.674, 'grad_norm': 15.28377628326416, 'learning_rate': 5.901796752034128e-05, 'epoch': 5.26}
{'eval_loss': 1.5137327909469604, 'eval_runtime': 169.0032, 'eval_samples_per_second': 0.278, 'eval_steps_per_second': 0.278, 'epoch': 5.93}

================================================================================
üîç COMPUTING CER ON VALIDATION SET (Epoch 5)
================================================================================
   ‚úÖ Validation CER: 3.0770 (307.70%)
   üìä No improvement. Best CER remains: 2.7711
================================================================================

{'loss': 6.4669, 'grad_norm': 14.53710651397705, 'learning_rate': 3.110330809243134e-05, 'epoch': 6.01}
{'loss': 5.2764, 'grad_norm': 11.124725341796875, 'learning_rate': 1.097615491916485e-05, 'epoch': 6.76}
{'eval_loss': 1.5562419891357422, 'eval_runtime': 168.8533, 'eval_samples_per_second': 0.278, 'eval_steps_per_second': 0.278, 'epoch': 6.99}

================================================================================
üîç COMPUTING CER ON VALIDATION SET (Epoch 6)
================================================================================
   ‚úÖ Validation CER: 3.1829 (318.29%)
   üìä No improvement. Best CER remains: 2.7711
================================================================================

{'loss': 5.7749, 'grad_norm': 13.775650978088379, 'learning_rate': 9.11513184176116e-07, 'epoch': 7.51}
{'eval_loss': 1.560777187347412, 'eval_runtime': 169.3416, 'eval_samples_per_second': 0.278, 'eval_steps_per_second': 0.278, 'epoch': 7.81}

================================================================================
üîç COMPUTING CER ON VALIDATION SET (Epoch 7)
================================================================================
   ‚úÖ Validation CER: 3.1417 (314.17%)
   üìä No improvement. Best CER remains: 2.7711
================================================================================

{'train_runtime': 39259.124, 'train_samples_per_second': 0.043, 'train_steps_per_second': 0.003, 'train_loss': 9.985765108695396, 'epoch': 7.81}
‚úÖ Stage 2 done.
   üéØ Best Validation CER: 2.7711
   üíæ Best model saved at: /home/vault/iwi5/iwi5298h/models_image_text/phi/multistage/inven/best_model

================================================================================
PHASE 3: EVALUATION ON TEST SET (autoregressive)
================================================================================
‚è≥ Loading best model from: /home/vault/iwi5/iwi5298h/models_image_text/phi/multistage/inven/best_model
üìä Running inference on 48 test samples...
[1/48] inventarbuch-022.jpg
[2/48] inventarbuch-099.jpg
[3/48] inventarbuch-245.jpg
[4/48] inventarbuch-263.jpg
[5/48] inventarbuch-033.jpg
[6/48] inventarbuch-143.jpg
[7/48] inventarbuch-244.jpg
[8/48] inventarbuch-024.jpg
[9/48] inventarbuch-141.jpg
[10/48] inventarbuch-183.jpg
[11/48] inventarbuch-191.jpg
[12/48] inventarbuch-051.jpg
[13/48] inventarbuch-203.jpg
[14/48] inventarbuch-296.jpg
[15/48] inventarbuch-302.jpg
[16/48] inventarbuch-179.jpg
[17/48] inventarbuch-114.jpg
[18/48] inventarbuch-082.jpg
[19/48] inventarbuch-287.jpg
[20/48] inventarbuch-181.jpg
[21/48] inventarbuch-299.jpg
[22/48] inventarbuch-084.jpg
[23/48] inventarbuch-004.jpg
[24/48] inventarbuch-148.jpg
[25/48] inventarbuch-238.jpg
[26/48] inventarbuch-116.jpg
[27/48] inventarbuch-223.jpg
[28/48] inventarbuch-104.jpg
[29/48] inventarbuch-015.jpg
[30/48] inventarbuch-272.jpg
[31/48] inventarbuch-124.jpg
[32/48] inventarbuch-115.jpg
[33/48] inventarbuch-049.jpg
[34/48] inventarbuch-017.jpg
[35/48] inventarbuch-018.jpg
[36/48] inventarbuch-225.jpg
[37/48] inventarbuch-046.jpg
[38/48] inventarbuch-294.jpg
[39/48] inventarbuch-054.jpg
[40/48] inventarbuch-073.jpg
[41/48] inventarbuch-118.jpg
[42/48] inventarbuch-130.jpg
[43/48] inventarbuch-146.jpg
[44/48] inventarbuch-014.jpg
[45/48] inventarbuch-059.jpg
[46/48] inventarbuch-256.jpg
[47/48] inventarbuch-260.jpg
[48/48] inventarbuch-279.jpg

================================================================================
üìä FINAL TEST RESULTS
================================================================================
Total: 48
Avg CER: 3.1202 (312.02%)
Perfect (CER=0): 0/48
Good (CER<0.1): 1/48
Results saved to: /home/vault/iwi5/iwi5298h/models_image_text/phi/multistage/inven/test_predictions.jsonl

‚úÖ Summary saved to: /home/vault/iwi5/iwi5298h/models_image_text/phi/multistage/inven/training_summary.txt
üéâ Done!
Finished at: Mon Nov  3 02:25:14 PM CET 2025
Exit status: 0
=== JOB_STATISTICS ===
=== current date     : Mon Nov  3 02:25:14 PM CET 2025
= Job-ID             : 1295454 on tinygpu
= Job-Name           : inven2_with_ms
= Job-Command        : /home/hpc/iwi5/iwi5298h/Uddipan-Thesis/jobfiles/job_phi.sh
= Initial workdir    : /home/hpc/iwi5/iwi5298h/Uddipan-Thesis/jobfiles
= Queue/Partition    : v100
= Slurm account      : iwi5 with QOS=normal
= Requested resources:  for 1-00:00:00
= Elapsed runtime    : 13:22:41
= Total RAM usage    : 10.7 GiB of requested  GiB (%)   
= Node list          : tg073
= Subm/Elig/Start/End: 2025-11-03T01:02:02 / 2025-11-03T01:02:02 / 2025-11-03T01:02:03 / 2025-11-03T14:24:44
======================
=== Quota infos ======
    Path                 Used     SoftQ    HardQ    Gracetime  Filec    FileQ    FiHaQ    FileGrace    
    /home/woody           184.1G  1000.0G  1500.0G        N/A     841K   5,000K   7,500K        N/A    
    /home/hpc             102.3G   104.9G   209.7G        N/A  30,542      500K   1,000K        N/A    
    /home/vault           860.8G  1048.6G  2097.2G        N/A   4,954      200K     400K        N/A    
======================
=== GPU utilization ==
gpu_name, gpu_bus_id, pid, gpu_utilization [%], mem_utilization [%], max_memory_usage [MiB], time [ms]
Tesla V100-PCIE-32GB, 00000000:18:00.0, 377000, 65 %, 24 %, 9896 MiB, 48129602 ms
