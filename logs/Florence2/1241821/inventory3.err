2025-10-15 02:55:19,269 - INFO - Using device: cuda
2025-10-15 02:55:19,269 - INFO - Output directory: /home/vault/iwi5/iwi5298h/models_image_text/florence2/inventory/lora_improved_20251015_025519
2025-10-15 02:55:19,269 - INFO - Loading Florence-2 model with improved LoRA config...
2025-10-15 02:55:35,786 - INFO - Trainable parameters: 3,538,944 (0.45%)
2025-10-15 02:55:36,307 - INFO - Model with improved LoRA loaded successfully!
2025-10-15 02:55:36,307 - INFO - Preparing datasets...
2025-10-15 02:55:36,307 - INFO - Train dataset size: 213
2025-10-15 02:55:36,307 - INFO - Validation dataset size: 47
No label_names provided for model class `PeftModelForCausalLM`. Since `PeftModel` hides base models input arguments, if label_names is not given, label_names can't be set automatically within `Trainer`. Note that empty label_names list will be used instead.
2025-10-15 02:55:36,621 - INFO - Starting improved LoRA training...
Using EarlyStoppingCallback without load_best_model_at_end=True. Once training is finished, the best model will not be loaded automatically.
  0%|          | 0/405 [00:00<?, ?it/s]  0%|          | 1/405 [00:03<23:55,  3.55s/it]                                                 0%|          | 1/405 [00:03<23:55,  3.55s/it]  0%|          | 2/405 [00:04<12:49,  1.91s/it]  1%|          | 3/405 [00:05<09:10,  1.37s/it]  1%|          | 4/405 [00:05<07:32,  1.13s/it]  1%|          | 5/405 [00:06<06:34,  1.01it/s]                                                 1%|          | 5/405 [00:06<06:34,  1.01it/s]  1%|â–         | 6/405 [00:07<06:05,  1.09it/s]  2%|â–         | 7/405 [00:08<05:45,  1.15it/s]  2%|â–         | 8/405 [00:08<05:29,  1.21it/s]  2%|â–         | 9/405 [00:09<05:20,  1.23it/s]  2%|â–         | 10/405 [00:10<05:15,  1.25it/s]                                                  2%|â–         | 10/405 [00:10<05:15,  1.25it/s]  3%|â–Ž         | 11/405 [00:11<05:13,  1.25it/s]  3%|â–Ž         | 12/405 [00:11<05:09,  1.27it/s]  3%|â–Ž         | 13/405 [00:12<05:06,  1.28it/s]  3%|â–Ž         | 14/405 [00:13<05:02,  1.29it/s]  4%|â–Ž         | 15/405 [00:14<05:01,  1.30it/s]                                                  4%|â–Ž         | 15/405 [00:14<05:01,  1.30it/s]  4%|â–         | 16/405 [00:14<04:58,  1.30it/s]  4%|â–         | 17/405 [00:15<04:52,  1.33it/s]  4%|â–         | 18/405 [00:16<04:54,  1.31it/s]  5%|â–         | 19/405 [00:17<04:52,  1.32it/s]  5%|â–         | 20/405 [00:17<04:48,  1.33it/s]                                                  5%|â–         | 20/405 [00:17<04:48,  1.33it/s]  5%|â–Œ         | 21/405 [00:18<04:51,  1.32it/s]  5%|â–Œ         | 22/405 [00:19<04:51,  1.31it/s]  6%|â–Œ         | 23/405 [00:20<04:53,  1.30it/s]  6%|â–Œ         | 24/405 [00:21<04:50,  1.31it/s]  6%|â–Œ         | 25/405 [00:21<04:47,  1.32it/s]                                                  6%|â–Œ         | 25/405 [00:21<04:47,  1.32it/s]  6%|â–‹         | 26/405 [00:22<04:46,  1.32it/s]  7%|â–‹         | 27/405 [00:23<04:34,  1.38it/s]
  0%|          | 0/12 [00:00<?, ?it/s][A
 17%|â–ˆâ–‹        | 2/12 [00:00<00:01,  8.24it/s][A
 25%|â–ˆâ–ˆâ–Œ       | 3/12 [00:00<00:01,  5.88it/s][A
 33%|â–ˆâ–ˆâ–ˆâ–Ž      | 4/12 [00:00<00:01,  4.97it/s][A
 42%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 5/12 [00:00<00:01,  4.62it/s][A
 50%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     | 6/12 [00:01<00:01,  4.29it/s][A
 58%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š    | 7/12 [00:01<00:01,  4.03it/s][A
 67%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹   | 8/12 [00:01<00:01,  3.86it/s][A
 75%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 9/12 [00:02<00:00,  3.75it/s][A
 83%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž | 10/12 [00:02<00:00,  3.60it/s][A
 92%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–| 11/12 [00:02<00:00,  3.03it/s][A
100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 12/12 [00:03<00:00,  3.08it/s][A                                                
                                               [A  7%|â–‹         | 27/405 [00:30<04:34,  1.38it/s]
100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 12/12 [00:07<00:00,  3.08it/s][A
                                               [A2025-10-15 02:56:08,084 - INFO - Epoch 1: CER=0.5673, Loss=4.0262, JSON Valid=0.0%
2025-10-15 02:56:08,815 - INFO - âœ“ New best model saved: CER=0.5673
  7%|â–‹         | 28/405 [00:33<21:54,  3.49s/it]  7%|â–‹         | 29/405 [00:33<16:40,  2.66s/it]  7%|â–‹         | 30/405 [00:34<13:03,  2.09s/it]                                                  7%|â–‹         | 30/405 [00:34<13:03,  2.09s/it]  8%|â–Š         | 31/405 [00:35<10:35,  1.70s/it]  8%|â–Š         | 32/405 [00:36<08:49,  1.42s/it]  8%|â–Š         | 33/405 [00:36<07:37,  1.23s/it]  8%|â–Š         | 34/405 [00:37<06:43,  1.09s/it]  9%|â–Š         | 35/405 [00:38<06:05,  1.01it/s]                                                  9%|â–Š         | 35/405 [00:38<06:05,  1.01it/s]  9%|â–‰         | 36/405 [00:39<05:40,  1.08it/s]  9%|â–‰         | 37/405 [00:39<05:21,  1.14it/s]  9%|â–‰         | 38/405 [00:40<05:10,  1.18it/s] 10%|â–‰         | 39/405 [00:41<04:56,  1.24it/s] 10%|â–‰         | 40/405 [00:42<04:49,  1.26it/s]                                                 10%|â–‰         | 40/405 [00:42<04:49,  1.26it/s] 10%|â–ˆ         | 41/405 [00:43<04:45,  1.27it/s] 10%|â–ˆ         | 42/405 [00:43<04:42,  1.28it/s] 11%|â–ˆ         | 43/405 [00:44<04:38,  1.30it/s] 11%|â–ˆ         | 44/405 [00:45<04:35,  1.31it/s] 11%|â–ˆ         | 45/405 [00:46<04:34,  1.31it/s]                                                 11%|â–ˆ         | 45/405 [00:46<04:34,  1.31it/s] 11%|â–ˆâ–        | 46/405 [00:46<04:38,  1.29it/s] 12%|â–ˆâ–        | 47/405 [00:47<04:32,  1.31it/s] 12%|â–ˆâ–        | 48/405 [00:48<04:33,  1.31it/s] 12%|â–ˆâ–        | 49/405 [00:49<04:32,  1.31it/s] 12%|â–ˆâ–        | 50/405 [00:49<04:31,  1.31it/s]                                                 12%|â–ˆâ–        | 50/405 [00:49<04:31,  1.31it/s] 13%|â–ˆâ–Ž        | 51/405 [00:50<04:34,  1.29it/s] 13%|â–ˆâ–Ž        | 52/405 [00:51<04:30,  1.30it/s] 13%|â–ˆâ–Ž        | 53/405 [00:52<04:31,  1.30it/s] 13%|â–ˆâ–Ž        | 54/405 [00:52<04:15,  1.37it/s]
  0%|          | 0/12 [00:00<?, ?it/s][A
 17%|â–ˆâ–‹        | 2/12 [00:00<00:01,  8.25it/s][A
 25%|â–ˆâ–ˆâ–Œ       | 3/12 [00:00<00:01,  5.86it/s][A
 33%|â–ˆâ–ˆâ–ˆâ–Ž      | 4/12 [00:00<00:01,  4.95it/s][A
 42%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 5/12 [00:00<00:01,  4.60it/s][A
 50%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     | 6/12 [00:01<00:01,  4.33it/s][A
 58%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š    | 7/12 [00:01<00:01,  4.04it/s][A
 67%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹   | 8/12 [00:01<00:01,  3.88it/s][A
 75%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 9/12 [00:02<00:00,  3.72it/s][A
 83%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž | 10/12 [00:02<00:00,  3.74it/s][A
 92%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–| 11/12 [00:02<00:00,  3.02it/s][A
100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 12/12 [00:03<00:00,  3.10it/s][A                                                
                                               [A 13%|â–ˆâ–Ž        | 54/405 [01:00<04:15,  1.37it/s]
100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 12/12 [00:07<00:00,  3.10it/s][A
                                               [A2025-10-15 02:56:37,831 - INFO - Epoch 2: CER=0.5784, Loss=3.4767, JSON Valid=0.0%
 14%|â–ˆâ–Ž        | 55/405 [01:02<19:19,  3.31s/it]                                                 14%|â–ˆâ–Ž        | 55/405 [01:02<19:19,  3.31s/it] 14%|â–ˆâ–        | 56/405 [01:02<14:52,  2.56s/it] 14%|â–ˆâ–        | 57/405 [01:03<11:42,  2.02s/it] 14%|â–ˆâ–        | 58/405 [01:04<09:28,  1.64s/it] 15%|â–ˆâ–        | 59/405 [01:05<07:55,  1.37s/it] 15%|â–ˆâ–        | 60/405 [01:06<06:52,  1.20s/it]                                                 15%|â–ˆâ–        | 60/405 [01:06<06:52,  1.20s/it] 15%|â–ˆâ–Œ        | 61/405 [01:06<06:08,  1.07s/it] 15%|â–ˆâ–Œ        | 62/405 [01:07<05:34,  1.03it/s] 16%|â–ˆâ–Œ        | 63/405 [01:08<05:16,  1.08it/s] 16%|â–ˆâ–Œ        | 64/405 [01:09<04:56,  1.15it/s] 16%|â–ˆâ–Œ        | 65/405 [01:09<04:39,  1.22it/s]                                                 16%|â–ˆâ–Œ        | 65/405 [01:09<04:39,  1.22it/s] 16%|â–ˆâ–‹        | 66/405 [01:10<04:34,  1.24it/s] 17%|â–ˆâ–‹        | 67/405 [01:11<04:28,  1.26it/s] 17%|â–ˆâ–‹        | 68/405 [01:12<04:23,  1.28it/s] 17%|â–ˆâ–‹        | 69/405 [01:12<04:19,  1.30it/s] 17%|â–ˆâ–‹        | 70/405 [01:13<04:19,  1.29it/s]                                                 17%|â–ˆâ–‹        | 70/405 [01:13<04:19,  1.29it/s] 18%|â–ˆâ–Š        | 71/405 [01:14<04:19,  1.29it/s] 18%|â–ˆâ–Š        | 72/405 [01:15<04:16,  1.30it/s] 18%|â–ˆâ–Š        | 73/405 [01:15<04:15,  1.30it/s] 18%|â–ˆâ–Š        | 74/405 [01:16<04:09,  1.33it/s] 19%|â–ˆâ–Š        | 75/405 [01:17<04:09,  1.32it/s]                                                 19%|â–ˆâ–Š        | 75/405 [01:17<04:09,  1.32it/s] 19%|â–ˆâ–‰        | 76/405 [01:18<04:08,  1.32it/s] 19%|â–ˆâ–‰        | 77/405 [01:18<04:07,  1.33it/s] 19%|â–ˆâ–‰        | 78/405 [01:19<04:06,  1.33it/s] 20%|â–ˆâ–‰        | 79/405 [01:20<04:03,  1.34it/s] 20%|â–ˆâ–‰        | 80/405 [01:21<04:02,  1.34it/s]                                                 20%|â–ˆâ–‰        | 80/405 [01:21<04:02,  1.34it/s] 20%|â–ˆâ–ˆ        | 81/405 [01:21<03:50,  1.41it/s]
  0%|          | 0/12 [00:00<?, ?it/s][A
 17%|â–ˆâ–‹        | 2/12 [00:00<00:01,  8.24it/s][A
 25%|â–ˆâ–ˆâ–Œ       | 3/12 [00:00<00:01,  5.85it/s][A
 33%|â–ˆâ–ˆâ–ˆâ–Ž      | 4/12 [00:00<00:01,  4.94it/s][A
 42%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 5/12 [00:00<00:01,  4.59it/s][A
 50%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     | 6/12 [00:01<00:01,  4.27it/s][A
 58%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š    | 7/12 [00:01<00:01,  4.11it/s][A
 67%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹   | 8/12 [00:01<00:01,  3.99it/s][A
 75%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 9/12 [00:02<00:00,  3.82it/s][A
 83%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž | 10/12 [00:02<00:00,  3.74it/s][A
 92%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–| 11/12 [00:02<00:00,  3.68it/s][A
100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 12/12 [00:03<00:00,  3.00it/s][A                                                
                                               [A 20%|â–ˆâ–ˆ        | 81/405 [01:29<03:50,  1.41it/s]
100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 12/12 [00:07<00:00,  3.00it/s][A
                                               [A2025-10-15 02:57:06,658 - INFO - Epoch 3: CER=0.6243, Loss=3.1147, JSON Valid=0.0%
 20%|â–ˆâ–ˆ        | 82/405 [01:31<17:48,  3.31s/it] 20%|â–ˆâ–ˆ        | 83/405 [01:31<13:41,  2.55s/it] 21%|â–ˆâ–ˆ        | 84/405 [01:32<10:45,  2.01s/it] 21%|â–ˆâ–ˆ        | 85/405 [01:33<08:44,  1.64s/it]                                                 21%|â–ˆâ–ˆ        | 85/405 [01:33<08:44,  1.64s/it] 21%|â–ˆâ–ˆ        | 86/405 [01:34<07:17,  1.37s/it] 21%|â–ˆâ–ˆâ–       | 87/405 [01:34<06:16,  1.19s/it] 22%|â–ˆâ–ˆâ–       | 88/405 [01:35<05:31,  1.05s/it] 22%|â–ˆâ–ˆâ–       | 89/405 [01:36<05:06,  1.03it/s] 22%|â–ˆâ–ˆâ–       | 90/405 [01:37<04:42,  1.11it/s]                                                 22%|â–ˆâ–ˆâ–       | 90/405 [01:37<04:42,  1.11it/s] 22%|â–ˆâ–ˆâ–       | 91/405 [01:37<04:31,  1.16it/s] 23%|â–ˆâ–ˆâ–Ž       | 92/405 [01:38<04:18,  1.21it/s] 23%|â–ˆâ–ˆâ–Ž       | 93/405 [01:39<04:09,  1.25it/s] 23%|â–ˆâ–ˆâ–Ž       | 94/405 [01:40<04:05,  1.26it/s] 23%|â–ˆâ–ˆâ–Ž       | 95/405 [01:40<03:59,  1.29it/s]                                                 23%|â–ˆâ–ˆâ–Ž       | 95/405 [01:40<03:59,  1.29it/s] 24%|â–ˆâ–ˆâ–Ž       | 96/405 [01:41<04:00,  1.29it/s] 24%|â–ˆâ–ˆâ–       | 97/405 [01:42<03:56,  1.30it/s] 24%|â–ˆâ–ˆâ–       | 98/405 [01:43<03:55,  1.30it/s] 24%|â–ˆâ–ˆâ–       | 99/405 [01:44<03:53,  1.31it/s] 25%|â–ˆâ–ˆâ–       | 100/405 [01:44<03:52,  1.31it/s]                                                  25%|â–ˆâ–ˆâ–       | 100/405 [01:44<03:52,  1.31it/s] 25%|â–ˆâ–ˆâ–       | 101/405 [01:45<03:51,  1.31it/s] 25%|â–ˆâ–ˆâ–Œ       | 102/405 [01:46<03:51,  1.31it/s] 25%|â–ˆâ–ˆâ–Œ       | 103/405 [01:47<03:52,  1.30it/s] 26%|â–ˆâ–ˆâ–Œ       | 104/405 [01:47<03:52,  1.30it/s] 26%|â–ˆâ–ˆâ–Œ       | 105/405 [01:48<03:50,  1.30it/s]                                                  26%|â–ˆâ–ˆâ–Œ       | 105/405 [01:48<03:50,  1.30it/s] 26%|â–ˆâ–ˆâ–Œ       | 106/405 [01:49<03:50,  1.29it/s] 26%|â–ˆâ–ˆâ–‹       | 107/405 [01:50<03:48,  1.30it/s] 27%|â–ˆâ–ˆâ–‹       | 108/405 [01:50<03:33,  1.39it/s]
  0%|          | 0/12 [00:00<?, ?it/s][A
 17%|â–ˆâ–‹        | 2/12 [00:00<00:01,  8.23it/s][A
 25%|â–ˆâ–ˆâ–Œ       | 3/12 [00:00<00:01,  5.84it/s][A
 33%|â–ˆâ–ˆâ–ˆâ–Ž      | 4/12 [00:00<00:01,  4.94it/s][A
 42%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 5/12 [00:00<00:01,  4.59it/s][A
 50%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     | 6/12 [00:01<00:01,  4.32it/s][A
 58%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š    | 7/12 [00:01<00:01,  3.99it/s][A
 67%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹   | 8/12 [00:01<00:01,  3.79it/s][A
 75%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 9/12 [00:02<00:00,  3.64it/s][A
 83%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž | 10/12 [00:02<00:00,  3.63it/s][A
 92%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–| 11/12 [00:02<00:00,  3.02it/s][A
100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 12/12 [00:03<00:00,  3.07it/s][A                                                 
                                               [A 27%|â–ˆâ–ˆâ–‹       | 108/405 [01:58<03:33,  1.39it/s]
100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 12/12 [00:07<00:00,  3.07it/s][A
                                               [A2025-10-15 02:57:35,639 - INFO - Epoch 4: CER=0.7029, Loss=2.8723, JSON Valid=0.0%
                                                  27%|â–ˆâ–ˆâ–‹       | 108/405 [01:58<03:33,  1.39it/s] 27%|â–ˆâ–ˆâ–‹       | 108/405 [01:58<05:26,  1.10s/it]
2025-10-15 02:57:35,660 - INFO - âœ“ Training completed! Best CER: 0.5673
2025-10-15 02:57:35,660 - INFO - Making predictions with best LoRA model...
2025-10-15 02:58:23,032 - INFO - Processing 10/48
2025-10-15 02:59:24,925 - INFO - Processing 20/48
2025-10-15 03:00:31,049 - INFO - Processing 30/48
2025-10-15 03:01:43,528 - INFO - Processing 40/48
2025-10-15 03:02:43,238 - INFO - 
============================================================
2025-10-15 03:02:43,239 - INFO - TEST RESULTS - IMPROVED LORA
2025-10-15 03:02:43,239 - INFO - ============================================================
2025-10-15 03:02:43,239 - INFO - Average CER: 0.6112 (61.12%)
2025-10-15 03:02:43,239 - INFO - Perfect matches: 0/48 (0.0%)
2025-10-15 03:02:43,239 - INFO - ============================================================
